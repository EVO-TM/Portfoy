<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Evo Studios | Dashboard</title>
  <link rel="icon" type="image/png" href="evo_logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    :root {
      --bg1: #090e1a;
      --bg2: #141f4d;
      --ink: #1e2430;
      --card: rgba(255, 255, 255, 0.92);
      --accent: #6c5ce7;
      --accent-hover: #5a4bcf;
      --ok: #00b894;
      --warn: #f1c40f;
      --danger: #ff4757;
      --border: rgba(30, 36, 48, 0.12);
    }
    
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; min-height: 100vh;
      font-family: 'Outfit', sans-serif;
      background:
        radial-gradient(1200px circle at 20% 20%, rgba(108,92,231,0.25), transparent 55%),
        radial-gradient(900px circle at 80% 30%, rgba(0,184,148,0.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      display: flex; align-items: center; justify-content: center;
      padding: 22px;
      color: var(--ink);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: rgba(108,92,231,0.4); border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

    /* Animations */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .panel {
      width: 100%; max-width: 1150px;
      background: var(--card);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 2px solid rgba(255, 255, 255, 0.5);
      border-radius: 24px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.25), inset 0 0 0 1px rgba(255,255,255,0.2);
      overflow: hidden;
      animation: slideUp 0.5s ease-out forwards;
    }

    .topbar {
      padding: 20px 24px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      background: linear-gradient(135deg, rgba(108,92,231,0.1), rgba(0,184,148,0.05));
      border-bottom: 1px solid var(--border);
    }

    .brand { display: flex; align-items: center; gap: 12px; font-weight: 900; font-size: 20px; }
    .brand i { color: var(--accent); font-size: 24px; }
    .actions { display: flex; gap: 12px; flex-wrap: wrap; justify-content: flex-end; }
    
    .btn {
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 12px;
      padding: 10px 16px;
      cursor: pointer;
      font-weight: 800;
      color: var(--ink);
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      text-decoration: none;
      box-shadow: 0 4px 6px rgba(0,0,0,0.04);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'Outfit', sans-serif;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); border-color: rgba(0,0,0,0.2); }
    .btn:active { transform: translateY(0) scale(0.97); }
    
    .btn.primary { background: linear-gradient(135deg, var(--accent), var(--accent-hover)); border: none; color: #fff; box-shadow: 0 6px 15px rgba(108,92,231,0.3); }
    .btn.danger { background: #fff0f0; border-color: #ffb3b3; color: var(--danger); }
    .btn.danger:hover { background: var(--danger); color: #fff; border-color: var(--danger); }

    .body { padding: 24px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    @media(max-width:900px){ .grid { grid-template-columns: 1fr; } }

    .card {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.03);
      transition: all 0.3s ease;
    }
    .card:hover { background: rgba(255, 255, 255, 0.9); box-shadow: 0 15px 35px rgba(0,0,0,0.06); }
    .card h2 { margin: 0 0 8px 0; font-size: 20px; display: flex; align-items: center; gap: 10px; }
    
    .muted { color: #6b7280; font-family: 'Inter', sans-serif; font-size: 13px; line-height: 1.5; }
    
    label { display: block; font-weight: 800; margin: 16px 0 8px 0; font-size: 14px; color: #374151; }
    
    input, textarea, select {
      width: 100%;
      border: 2px solid var(--border);
      background: #fff;
      border-radius: 12px;
      padding: 12px 16px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
      color: var(--ink);
    }
    input:focus, textarea:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(108,92,231,0.15);
    }
    textarea { min-height: 120px; resize: vertical; }
    
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .row > * { flex: 1; min-width: 200px; }
    
    .list { margin-top: 16px; display: flex; flex-direction: column; gap: 12px; max-height: 380px; overflow-y: auto; padding-right: 8px; }
    
    .item {
      display: flex; gap: 16px; align-items: flex-start;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
      background: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
      animation: slideUp 0.3s ease-out forwards;
    }
    .item:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
    
    .thumb {
      width: 80px; height: 60px;
      border-radius: 10px;
      background: var(--bg1);
      overflow: hidden;
      flex: 0 0 auto;
      display: flex; align-items: center; justify-content: center;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
    .thumb img { width: 100%; height: 100%; object-fit: cover; }
    .item-title { font-weight: 900; font-size: 15px; }
    .item-meta { font-size: 12px; color: #6b7280; font-family: 'Inter', sans-serif; margin-top: 4px; }
    .item-meta a { color: var(--accent); text-decoration: none; font-weight: 600; }
    .item-meta a:hover { text-decoration: underline; }
    .item-actions { margin-left: auto; display: flex; gap: 8px; }
    
    .mini {
      border: 1px solid var(--border); background: #f9fafb; border-radius: 10px;
      padding: 8px 12px; font-weight: 800; cursor: pointer; transition: 0.2s;
    }
    .mini:hover { background: #f3f4f6; transform: scale(1.05); }
    .mini.del { background: #fff0f0; border-color: #ffb3b3; color: var(--danger); }
    .mini.del:hover { background: var(--danger); color: #fff; border-color: var(--danger); }

    /* Login Specific */
    .login-wrap { max-width: 440px; margin: 20px auto; }
    .login-card { text-align: center; padding: 40px 30px; }
    .lock { font-size: 50px; color: var(--accent); margin: 0 0 16px 0; }
    .hint { margin-top: 20px; font-size: 12px; color: #9ca3af; font-family: 'Inter', sans-serif; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px; }
    
    .split { display: flex; gap: 20px; align-items: center; flex-wrap: wrap; }
    .avatarPreview {
      width: 90px; height: 90px; border-radius: 20px; background: var(--bg1); overflow: hidden;
      border: 3px solid #fff; box-shadow: 0 8px 15px rgba(0,0,0,0.1);
      display: flex; align-items: center; justify-content: center; flex: 0 0 auto;
    }
    .avatarPreview img { width: 100%; height: 100%; object-fit: cover; }

    /* Loader */
    #btnLoader { display: none; margin-left: 8px; animation: pulse 1s infinite; }
  </style>
</head>
<body>

  <div class="panel">
    <div class="topbar">
      <div class="brand"><i class="fa-solid fa-gamepad"></i> EVO Dashboard</div>
      <div class="actions">
        <a class="btn" href="index.html"><i class="fa-solid fa-earth-americas"></i> Siteye DÃ¶n</a>
        <button class="btn danger" id="logoutBtn" style="display:none;"><i class="fa-solid fa-right-from-bracket"></i> Ã‡Ä±kÄ±ÅŸ</button>
      </div>
    </div>

    <!-- LOGIN VIEW -->
    <div class="body" id="loginView">
      <div class="login-wrap">
        <div class="card login-card">
          <div class="lock"><i class="fa-solid fa-shield-halved"></i></div>
          <h1 style="margin:0 0 8px 0; font-size:26px;">YÃ¶netim Paneli</h1>
          <div class="muted">Devam etmek iÃ§in yÃ¶netici kimliÄŸinizi doÄŸrulayÄ±n.</div>

          <div style="text-align: left; margin-top: 24px;">
            <label>KullanÄ±cÄ± AdÄ±</label>
            <input id="userInput" placeholder="Admin username" autocomplete="username"/>

            <label>Åifre</label>
            <input id="passInput" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"/>
          </div>

          <div style="margin-top:24px; display:flex; flex-direction:column; gap:12px;">
            <button class="btn primary" id="loginActionButton" style="width: 100%; padding: 14px;" onclick="login()">
              <i class="fa-solid fa-key"></i> GiriÅŸ Yap 
              <i class="fa-solid fa-spinner fa-spin" id="btnLoader"></i>
            </button>
          </div>

          <div class="hint">
            <i class="fa-solid fa-shield-cat"></i> Brute-force ve AFK korumasÄ± aktiftir. Ã‡oklu hatalÄ± giriÅŸte sistem geÃ§ici olarak kilitlenir.
          </div>
        </div>
      </div>
    </div>

    <!-- DASHBOARD VIEW -->
    <div class="body" id="dashView" style="display:none;">
      <div class="grid">

        <!-- PROFILE -->
        <div class="card">
          <h2><i class="fa-solid fa-user-astronaut" style="color:var(--accent)"></i> Profil YÃ¶netimi</h2>
          <div class="muted">Site Ã¼zerindeki kimliÄŸinizi ve logonuzu buradan ayarlayÄ±n.</div>

          <div class="split" style="margin-top:20px;">
            <div class="avatarPreview"><img id="avatarPreview" src="evo_logo.png" alt="Avatar" onerror="this.src='https://via.placeholder.com/90x90/141f4d/ffffff?text=EVO'"></div>
            <div style="flex:1; min-width:220px;">
              <label style="margin-top:0;">GÃ¶rÃ¼nen Ä°sim</label>
              <input id="pName" placeholder="Ã–rn: EVO Studios" />
              <label>KullanÄ±cÄ± AdÄ± (@)</label>
              <input id="pHandle" placeholder="Ã–rn: @EvoStudiosOffical" />
            </div>
          </div>

          <label>Avatar URL (Resim Linki)</label>
          <input id="pAvatar" placeholder="https://..." oninput="document.getElementById('avatarPreview').src=this.value || 'evo_logo.png';" />

          <div class="row" style="margin-top:20px;">
            <button class="btn primary" onclick="saveProfile()"><i class="fa-solid fa-floppy-disk"></i> Profili Kaydet</button>
            <button class="btn" onclick="resetProfile()"><i class="fa-solid fa-rotate-left"></i></button>
          </div>
        </div>

        <!-- MODELS -->
        <div class="card">
          <h2><i class="fa-solid fa-cube" style="color:var(--ok)"></i> Ãœcretsiz Modeller</h2>
          <div class="muted">Portfolyona veya topluluÄŸa sunduÄŸun aÃ§Ä±k kaynak modeller.</div>

          <div class="row" style="margin-top:16px;">
            <div>
              <label style="margin-top:0;">Model AdÄ±</label>
              <input id="mTitle" placeholder="Ã–rn: Sci-Fi Weapon Pack" />
            </div>
            <div>
              <label style="margin-top:0;">Roblox Link</label>
              <input id="mLink" placeholder="https://create.roblox.com/..." />
            </div>
          </div>

          <div class="row">
            <div>
              <label>GÃ¶rsel URL (Opsiyonel)</label>
              <input id="mThumb" placeholder="https://..." />
            </div>
            <div>
              <label>KÄ±sa Not</label>
              <input id="mNote" placeholder="Ã–rn: R15 Uyumlu / Animasyonlu" />
            </div>
          </div>

          <div class="row">
            <div>
              <label>Model DosyasÄ± (rbxm/zip) (Opsiyonel)</label>
              <input id="mFile" type="file" accept=".rbxm,.rbxmx,.zip,.rar,application/zip,application/x-rar-compressed" />
              <div class="muted" style="margin-top:6px;">Dosya yÃ¼klersen, sitede direkt indirilebilir olacak. (Sunucusuz: tarayÄ±cÄ± depolama)</div>
            </div>
            <div>
              <label>GÃ¶rsel DosyasÄ± (Opsiyonel)</label>
              <input id="mThumbFile" type="file" accept="image/*" />
            </div>
          </div>


          <div class="row" style="margin-top:20px;">
            <button class="btn primary" onclick="addModel()"><i class="fa-solid fa-plus"></i> Modele Ekle</button>
            <button class="btn danger" onclick="clearModelsConfirm()"><i class="fa-solid fa-trash"></i></button>
          </div>

          <div class="list" id="modelsList"></div>
        </div>

        <!-- FEED -->
        <div class="card">
          <h2><i class="fa-solid fa-bolt" style="color:var(--warn)"></i> Evo AkÄ±ÅŸÄ± (Duyurular)</h2>
          <div class="muted">GÃ¼ncellemeler, sÄ±zÄ±ntÄ±lar veya haberleri sitede paylaÅŸ.</div>

          <label>BaÅŸlÄ±k</label>
          <input id="fTitle" placeholder="Ã–rn: Yeni oyunumuz Beta aÅŸamasÄ±nda!" />

          <label>Ä°Ã§erik DetayÄ±</label>
          <textarea id="fContent" placeholder="TopluluÄŸa ne sÃ¶ylemek istersin?"></textarea>

          <div class="row">
            <div>
              <label>Kategori</label>
              <select id="fTag">
                <option value="info">ğŸ“¢ Genel Duyuru</option>
                <option value="update">ğŸš€ GÃ¼ncelleme</option>
                <option value="leak">ğŸ‘€ SÄ±zÄ±ntÄ± (Leak)</option>
              </select>
            </div>
            <div>
              <label>Medya Linki (Resim/Gif)</label>
              <input id="fMedia" placeholder="https://..." />
            </div>
          </div>

          <label>Medya DosyasÄ± (Opsiyonel)</label>
          <input id="fMediaFile" type="file" accept="image/*,.gif" />
          <div class="muted" style="margin-top:6px;">Dosya yÃ¼klersen, linke gerek yok. (Sunucusuz: tarayÄ±cÄ± depolama)</div>

          <label style="display:flex; align-items:center; gap:10px; margin-top:20px; cursor:pointer;">
            <input type="checkbox" id="fPinned" style="width:20px; height:20px; accent-color: var(--accent);" />
            <span>Bu gÃ¶nderiyi en baÅŸa tuttur (Pinned)</span>
          </label>

          <div class="row" style="margin-top:20px;">
            <button class="btn primary" onclick="addFeed()"><i class="fa-solid fa-paper-plane"></i> GÃ¶nderiyi PaylaÅŸ</button>
            <button class="btn danger" onclick="clearFeedConfirm()"><i class="fa-solid fa-trash"></i></button>
          </div>

          <div class="list" id="feedList"></div>
        </div>


        <!-- PROJECT / TEST GAME -->
        <div class="card">
          <h2><i class="fa-solid fa-gamepad" style="color:var(--accent)"></i> Test Oyun & GÃ¶rseller</h2>
          <div class="muted">Sitedeki proje/test oyun kartÄ±nÄ± buradan yÃ¶net.</div>

          <label>Oyun BaÅŸlÄ±ÄŸÄ±</label>
          <input id="gTitle" placeholder="Ã–rn: Sohbet Oyunu" />

          <label>Oyun Linki</label>
          <input id="gLink" placeholder="https://www.roblox.com/games/..." />

          <div class="row">
            <div>
              <label>Kapak GÃ¶rsel URL (Opsiyonel)</label>
              <input id="gThumb" placeholder="https://..." />
            </div>
            <div>
              <label>Kapak GÃ¶rsel DosyasÄ± (Opsiyonel)</label>
              <input id="gThumbFile" type="file" accept="image/*" />
            </div>
          </div>

          <label>AÃ§Ä±klama (Opsiyonel)</label>
          <textarea id="gDesc" placeholder="KÄ±sa proje aÃ§Ä±klamasÄ±..."></textarea>

          <div class="row" style="margin-top:20px;">
            <button class="btn primary" onclick="saveProject()"><i class="fa-solid fa-floppy-disk"></i> Projeyi Kaydet</button>
            <button class="btn danger" onclick="resetProject()"><i class="fa-solid fa-trash"></i></button>
          </div>
        </div>

        <!-- SYSTEM & BACKUP -->
        <div class="card">
          <h2><i class="fa-solid fa-server" style="color:#a55eea"></i> Sistem & Yedekleme</h2>
          <div class="muted">
            <p><strong>ğŸ›¡ï¸ GÃ¼venlik Durumu:</strong> Ä°stemci tabanlÄ± (Anti-Bruteforce Aktif).</p>
            <p><strong>ğŸ’¤ AFK KorumasÄ±:</strong> 10 dk iÅŸlem yapÄ±lmazsa oturum kapatÄ±lÄ±r.</p>
            <p>Verilerin tarayÄ±cÄ±da tutulur. BaÅŸka bir cihaza geÃ§mek istersen buradan yedeÄŸini indir ve diÄŸer cihazda iÃ§e aktar.</p>
          </div>

          <div style="margin-top:20px;" class="row">
            <button class="btn" style="flex:1;" onclick="exportAll()"><i class="fa-solid fa-download"></i> YedeÄŸi Ä°ndir</button>
            <label class="btn primary" style="flex:1; cursor:pointer; margin:0;">
              <i class="fa-solid fa-upload"></i> YedeÄŸi YÃ¼kle
              <input type="file" accept="application/json" style="display:none" onchange="importAll(event)" />
            </label>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
  // =========================================================
  // GÃœVENLÄ°K AYARLARI (KULLANICI ADI VE ÅÄ°FRENÄ° BURADAN DEÄÄ°ÅTÄ°R)
  // Hash karmaÅŸasÄ± kaldÄ±rÄ±ldÄ±. Direkt buraya yazabilirsin.
  // =========================================================
  const ADMIN_USER = "evoadmin";
  const ADMIN_PASS = "EvoDev2024!";
  // =========================================================

  const AUTH_KEY = "evo_sess_token";
  const FAIL_KEY = "evo_sec_fails";
  const LOCK_KEY = "evo_sec_lock";
  
  const MODELS_KEY = "evo_models_data";
  const FEED_KEY = "evo_feed_data";
  const PROFILE_KEY = "evo_prof_data";
  const PROJECT_KEY = "evo_project_data";

  const $ = (id) => document.getElementById(id);
  const safeParse = (str, def) => { try { return JSON.parse(str); } catch { return def; } };
  const now = () => Date.now();

  const readFileAsDataURL = (file) => new Promise((resolve, reject) => {
    if (!file) return resolve(null);
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = (e) => reject(e);
    reader.readAsDataURL(file);
  });

  function downloadDataUrl(dataUrl, filename) {
    const a = document.createElement('a');
    a.href = dataUrl;
    a.download = filename || 'download';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }


  // --- GÃœVENLÄ°K KATMANI 1: BRUTE FORCE KORUMASI ---
  function getLockStatus() {
    const lockUntil = parseInt(localStorage.getItem(LOCK_KEY) || "0", 10);
    if (lockUntil > now()) return Math.ceil((lockUntil - now()) / 1000);
    return 0;
  }

  function registerFail() {
    let fails = parseInt(localStorage.getItem(FAIL_KEY) || "0", 10) + 1;
    localStorage.setItem(FAIL_KEY, String(fails));
    
    if (fails >= 3) {
      // 3 hata = 30sn, 4 hata = 2dk, 5+ hata = 10dk kilit.
      let penaltyMins = fails === 3 ? 0.5 : (fails === 4 ? 2 : 10);
      localStorage.setItem(LOCK_KEY, String(now() + (penaltyMins * 60 * 1000)));
      return penaltyMins * 60;
    }
    return 0;
  }

  function clearFails() {
    localStorage.removeItem(FAIL_KEY);
    localStorage.removeItem(LOCK_KEY);
  }

  // --- GÃœVENLÄ°K KATMANI 2: AFK/INACTIVITY LOGOUT ---
  let inactivityTimer;
  function resetAFK() {
    clearTimeout(inactivityTimer);
    if (sessionStorage.getItem(AUTH_KEY)) {
      // 10 Dakika (600,000 ms) iÅŸlem yapÄ±lmazsa Ã§Ä±kÄ±ÅŸ yap
      inactivityTimer = setTimeout(() => {
        alert("â±ï¸ GÃ¼venlik: Uzun sÃ¼re iÅŸlem yapÄ±lmadÄ±ÄŸÄ± iÃ§in oturum kapatÄ±ldÄ±.");
        logout();
      }, 600000); 
    }
  }
  // KullanÄ±cÄ± hareketlerini dinle
  window.onload = resetAFK;
  document.onmousemove = resetAFK;
  document.onkeypress = resetAFK;
  document.onclick = resetAFK;

  // --- GÄ°RÄ°Å / Ã‡IKIÅ YÃ–NETÄ°MÄ° ---
  function show(view) {
    $("loginView").style.display = view === "login" ? "block" : "none";
    $("dashView").style.display = view === "dash" ? "block" : "none";
    $("logoutBtn").style.display = view === "dash" ? "inline-flex" : "none";
  }

  function login() {
    const lockTime = getLockStatus();
    if (lockTime > 0) {
      alert(`ğŸš¨ Ã‡ok fazla hatalÄ± giriÅŸ denemesi! LÃ¼tfen ${lockTime} saniye bekleyin.`);
      return;
    }

    const u = ($("userInput").value || "").trim();
    const p = ($("passInput").value || "").trim();

    if (!u || !p) { alert("KullanÄ±cÄ± adÄ± ve ÅŸifre boÅŸ bÄ±rakÄ±lamaz."); return; }

    // GÃœVENLÄ°K KATMANI 3: Fake Network Latency (Sahte Gecikme ile botlarÄ± yavaÅŸlatma)
    $("btnLoader").style.display = "inline-block";
    $("loginActionButton").style.opacity = "0.7";
    $("loginActionButton").style.pointerEvents = "none";

    setTimeout(() => {
      $("btnLoader").style.display = "none";
      $("loginActionButton").style.opacity = "1";
      $("loginActionButton").style.pointerEvents = "auto";

      if (u === ADMIN_USER && p === ADMIN_PASS) {
        clearFails();
        // Basit ama etkili session token (Sadece tarayÄ±cÄ± kapanana kadar yaÅŸar)
        sessionStorage.setItem(AUTH_KEY, "AUTH_" + Math.random().toString(36).substr(2) + "_" + now());
        $("userInput").value = ""; $("passInput").value = "";
        initDashboard();
      } else {
        const lockedFor = registerFail();
        if (lockedFor > 0) {
          alert(`âŒ HatalÄ± ÅŸifre. Sistem ${lockedFor} saniye kilitlendi.`);
        } else {
          alert("âŒ HatalÄ± kullanÄ±cÄ± adÄ± veya ÅŸifre.");
        }
        $("passInput").value = "";
      }
    }, 800); // 800ms sahte bekleme
  }

  function logout() {
    sessionStorage.removeItem(AUTH_KEY);
    clearTimeout(inactivityTimer);
    show("login");
  }
  
  $("logoutBtn").addEventListener("click", logout);
  ["userInput","passInput"].forEach(id => {
    $(id)?.addEventListener("keydown", (e) => { if(e.key === "Enter") login(); });
  });

  // --- VERÄ° YÃ–NETÄ°MÄ° & RENDER ---
  function initDashboard() {
    show("dash");
    resetAFK();
    
    // Profil YÃ¼kle
    const p = safeParse(localStorage.getItem(PROFILE_KEY), null) || {};
    $("pName").value = p.displayName || "";
    $("pHandle").value = p.handle || "";
    $("pAvatar").value = p.avatarUrl || "";
    $("avatarPreview").src = p.avatarUrl || "evo_logo.png";

    renderModels();
    renderFeed();
    loadProject();
  }

  // Profil
  function saveProfile() {
    localStorage.setItem(PROFILE_KEY, JSON.stringify({
      displayName: $("pName").value.trim(),
      handle: $("pHandle").value.trim(),
      avatarUrl: $("pAvatar").value.trim()
    }));
    alert("âœ… Profil baÅŸarÄ±yla kaydedildi! Sitede yansÄ±yacaktÄ±r.");
  }
  function resetProfile() {
    if(!confirm("Profil verilerini sÄ±fÄ±rlamak istiyor musun?")) return;
    localStorage.removeItem(PROFILE_KEY);
    initDashboard();
  }


  // Project / Test Game
  const getProject = () => safeParse(localStorage.getItem(PROJECT_KEY), null) || {};

  function loadProject() {
    const g = getProject();
    $("gTitle").value = g.title || "";
    $("gLink").value = g.link || "";
    $("gThumb").value = g.thumbUrl || "";
    $("gDesc").value = g.desc || "";
  }

  async function saveProject() {
    const thumbFile = $("gThumbFile").files && $("gThumbFile").files[0];
    const thumbDataUrl = thumbFile ? await readFileAsDataURL(thumbFile) : null;
    const current = getProject();

    localStorage.setItem(PROJECT_KEY, JSON.stringify({
      title: $("gTitle").value.trim(),
      link: $("gLink").value.trim(),
      desc: $("gDesc").value.trim(),
      thumbUrl: $("gThumb").value.trim(),
      thumbDataUrl: thumbDataUrl || current.thumbDataUrl || "",
      updatedAt: now()
    }));

    alert("âœ… Proje/Test oyun kaydedildi! Sitede yansÄ±yacaktÄ±r.");
  }

  function resetProject() {
    if(!confirm("Proje/Test oyun verilerini sÄ±fÄ±rlamak istiyor musun?")) return;
    localStorage.removeItem(PROJECT_KEY);
    loadProject();
  }

  // Modeller
  const getModels = () => safeParse(localStorage.getItem(MODELS_KEY), []);
  const setModels = (d) => localStorage.setItem(MODELS_KEY, JSON.stringify(d));
  
  async function addModel() {
    const title = $("mTitle").value.trim(), link = $("mLink").value.trim();
    if(!title || !link) return alert("Model AdÄ± ve Linki zorunludur!");
    
    const models = getModels();

    const file = $("mFile").files && $("mFile").files[0];
    const thumbFile = $("mThumbFile").files && $("mThumbFile").files[0];

    const fileData = file ? await readFileAsDataURL(file) : "";
    const thumbDataUrl = thumbFile ? await readFileAsDataURL(thumbFile) : "";

    models.push({
      id: "mdl_" + now(), title, link,
      thumbUrl: $("mThumb").value.trim(),
      thumbDataUrl,
      note: $("mNote").value.trim(),
      fileName: file ? file.name : "",
      fileType: file ? (file.type || "") : "",
      fileData,
      createdAt: now()
    });
    setModels(models);
    
    $("mTitle").value=""; $("mLink").value=""; $("mThumb").value=""; $("mNote").value="";
    $("mFile").value=""; $("mThumbFile").value="";
    renderModels();
  }
  

  window.downloadModelFile = (id) => {
    const m = getModels().find(x => x.id === id);
    if(!m || !m.fileData) return alert("Bu modelde yÃ¼klÃ¼ dosya yok.");
    downloadDataUrl(m.fileData, m.fileName || (m.title + ".rbxm"));
  };

  window.deleteModel = (id) => {
    setModels(getModels().filter(m => m.id !== id));
    renderModels();
  };
  function clearModelsConfirm() {
    if(confirm("TÃ¼m modelleri kalÄ±cÄ± olarak silmek istediÄŸine emin misin?")) {
      localStorage.removeItem(MODELS_KEY); renderModels();
    }
  }

  function renderModels() {
    const list = $("modelsList");
    const arr = getModels().sort((a,b) => b.createdAt - a.createdAt);
    list.innerHTML = "";
    if(!arr.length) return list.innerHTML = '<div class="muted" style="text-align:center; padding:20px;">HenÃ¼z model eklenmedi.</div>';
    
    arr.forEach(m => {
      const thumb = m.thumbDataUrl || m.thumbUrl || 'https://via.placeholder.com/80x60/141f4d/ffffff?text=MODEL';
      list.innerHTML += `
        <div class="item">
          <div class="thumb"><img src="${thumb}" onerror="this.src='https://via.placeholder.com/80x60/141f4d/ffffff?text=HATA'"></div>
          <div style="flex:1; min-width:0;">
            <div class="item-title">${escapeHtml(m.title)}</div>
            <div class="item-meta">${escapeHtml(m.note || "Ãœcretsiz Model")}</div>
            <div class="item-meta"><a href="${m.link}" target="_blank"><i class="fa-solid fa-link"></i> Roblox'ta AÃ§</a></div>
          </div>
          ${m.fileData ? `<button class="mini" onclick="downloadModelFile('${m.id}')" title="Ä°ndir"><i class="fa-solid fa-download"></i></button>` : ""}
          <button class="mini del" onclick="deleteModel('${m.id}')" title="Sil"><i class="fa-solid fa-trash"></i></button>
        </div>`;
    });
  }

  // Feed (AkÄ±ÅŸ)
  const getFeed = () => safeParse(localStorage.getItem(FEED_KEY), []);
  const setFeed = (d) => localStorage.setItem(FEED_KEY, JSON.stringify(d));

  async function addFeed() {
    const title = $("fTitle").value.trim(), content = $("fContent").value.trim();
    if(!title || !content) return alert("BaÅŸlÄ±k ve iÃ§erik girmelisin.");
    
    const feed = getFeed();
    const mediaFile = $("fMediaFile").files && $("fMediaFile").files[0];
    const mediaDataUrl = mediaFile ? await readFileAsDataURL(mediaFile) : "";
    feed.push({
      id: "fd_" + now(), title, content,
      tag: $("fTag").value,
      mediaUrl: $("fMedia").value.trim(),
      mediaDataUrl,
      pinned: $("fPinned").checked,
      createdAt: now()
    });
    setFeed(feed);
    
    $("fTitle").value=""; $("fContent").value=""; $("fMedia").value=""; $("fMediaFile").value=""; $("fPinned").checked=false;
    renderFeed();
  }

  window.deleteFeed = (id) => {
    setFeed(getFeed().filter(f => f.id !== id));
    renderFeed();
  };
  function clearFeedConfirm() {
    if(confirm("TÃ¼m duyurularÄ± silmek istediÄŸine emin misin?")) {
      localStorage.removeItem(FEED_KEY); renderFeed();
    }
  }

  function renderFeed() {
    const list = $("feedList");
    const arr = getFeed().sort((a,b) => {
      if(a.pinned !== b.pinned) return b.pinned ? 1 : -1;
      return b.createdAt - a.createdAt;
    });
    
    list.innerHTML = "";
    if(!arr.length) return list.innerHTML = '<div class="muted" style="text-align:center; padding:20px;">HenÃ¼z duyuru paylaÅŸÄ±lmadÄ±.</div>';
    
    const icons = { info: "fa-bullhorn", update: "fa-rocket", leak: "fa-eye" };
    const colors = { info: "#3498db", update: "#2ecc71", leak: "#e74c3c" };

    arr.forEach(f => {
      const icon = icons[f.tag] || icons.info;
      const color = colors[f.tag] || colors.info;
      list.innerHTML += `
        <div class="item" style="${f.pinned ? 'border-left: 4px solid var(--warn);' : ''}">
          <div class="thumb" style="background:${color};"><i class="fa-solid ${icon}" style="color:#fff; font-size:24px;"></i></div>
          <div style="flex:1; min-width:0;">
            <div class="item-title">
              ${f.pinned ? '<i class="fa-solid fa-thumbtack" style="color:var(--warn); margin-right:5px;"></i>' : ''}
              ${escapeHtml(f.title)}
            </div>
            <div class="item-meta" style="color:var(--accent);">${new Date(f.createdAt).toLocaleString('tr-TR')}</div>
            <div class="item-meta" style="margin-top:8px; white-space:pre-wrap; color:#374151;">${escapeHtml(f.content)}</div>
            ${f.mediaUrl ? `<div class="item-meta" style="margin-top:8px;"><a href="${f.mediaUrl}" target="_blank"><i class="fa-solid fa-image"></i> MedyayÄ± GÃ¶rÃ¼ntÃ¼le</a></div>` : ''}
          </div>
          <button class="mini del" onclick="deleteFeed('${f.id}')" title="Sil"><i class="fa-solid fa-trash"></i></button>
        </div>`;
    });
  }

  // Backup Ä°Ã§e/DÄ±ÅŸa Aktar
  function exportAll() {
    const data = {
      profile: safeParse(localStorage.getItem(PROFILE_KEY), {}),
      models: getModels(),
      feed: getFeed(),
      project: getProject()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = `EVO_Yedek_${new Date().toISOString().slice(0,10)}.json`;
    a.click(); URL.revokeObjectURL(url);
  }

  function importAll(e) {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      const data = safeParse(reader.result, null);
      if(!data) return alert("âŒ GeÃ§ersiz dosya formatÄ±!");
      
      if(data.profile) localStorage.setItem(PROFILE_KEY, JSON.stringify(data.profile));
      if(data.models) localStorage.setItem(MODELS_KEY, JSON.stringify(data.models));
      if(data.feed) localStorage.setItem(FEED_KEY, JSON.stringify(data.feed));
      if(data.project) localStorage.setItem(PROJECT_KEY, JSON.stringify(data.project));
      
      alert("âœ… Yedek baÅŸarÄ±yla geri yÃ¼klendi!");
      initDashboard();
    };
    reader.readAsText(file);
    e.target.value = "";
  }

  function escapeHtml(str) {
    return String(str||"").replace(/[&<>"']/g, m => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
    })[m]);
  }

  // BaÅŸlangÄ±Ã§ KontrolÃ¼
  if (sessionStorage.getItem(AUTH_KEY)) {
    initDashboard();
  } else {
    show("login");
  }
</script>
</body>
</html>
